<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Geo Kombat — Duolingo-style Study</title>
<style>
  :root{
    --bg:#0b0e14;
    --panel:#0f1420;
    --card:#121a2a;
    --line:rgba(255,255,255,.09);
    --text:#e9eefc;
    --muted:#a8b4d6;
    --pri:#7c8cff;
    --pri2:#5d6bff;
    --good:#2cff88;
    --bad:#ff4b4b;
    --warn:#ffd166;
    --chip:rgba(255,255,255,.06);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background:
      radial-gradient(1200px 800px at 20% -10%, rgba(124,140,255,.20), transparent 60%),
      radial-gradient(900px 700px at 100% 10%, rgba(255,255,255,.06), transparent 55%),
      var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    padding:28px 18px;
  }
  .app{
    width:100%;
    max-width:1080px;
    background:rgba(15,20,32,.88);
    border:1px solid var(--line);
    border-radius:18px;
    padding:18px 18px 22px;
    box-shadow:0 28px 90px rgba(0,0,0,.55);
    backdrop-filter: blur(10px);
  }
  .top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:14px;
    flex-wrap:wrap;
  }
  .brand h1{
    margin:0;
    font-size:18px;
    letter-spacing:.6px;
    font-weight:950;
  }
  .brand .sub{
    margin-top:6px;
    font-size:12px;
    color:var(--muted);
  }
  .hud{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
    justify-content:flex-end;
  }
  .chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 10px;
    border-radius:999px;
    background:var(--chip);
    border:1px solid var(--line);
    color:var(--muted);
    font-size:12px;
    font-weight:900;
    letter-spacing:.2px;
    user-select:none;
  }
  .chip b{color:var(--text)}
  .progressBar{
    width:180px;
    height:10px;
    border-radius:999px;
    background:rgba(255,255,255,.06);
    border:1px solid var(--line);
    overflow:hidden;
  }
  .progressFill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,var(--pri),var(--pri2));
  }
  button{
    appearance:none;
    border:none;
    padding:10px 14px;
    border-radius:999px;
    font-weight:950;
    letter-spacing:.2px;
    cursor:pointer;
    color:var(--text);
    background:rgba(255,255,255,.06);
    border:1px solid var(--line);
  }
  button.primary{background:linear-gradient(180deg,var(--pri),var(--pri2)); border:none}
  button.ghost{background:transparent}
  button:disabled{opacity:.55; cursor:not-allowed}
  select{
    background:rgba(255,255,255,.06);
    border:1px solid var(--line);
    color:var(--text);
    padding:10px 12px;
    border-radius:12px;
    font-weight:900;
    outline:none;
  }
  .screen{display:none; margin-top:14px;}
  .screen.active{display:block;}
  .card{
    margin-top:12px;
    background:linear-gradient(180deg, rgba(18,26,42,.92), rgba(18,26,42,.70));
    border:1px solid var(--line);
    border-radius:16px;
    padding:16px;
  }
  .grid2{display:grid; grid-template-columns: 1.1fr .9fr; gap:12px;}
  @media(max-width:920px){.grid2{grid-template-columns:1fr}}
  .muted{color:var(--muted)}
  .divider{height:1px;background:var(--line); margin:14px 0;}
  .modeGrid{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
  @media(max-width:720px){.modeGrid{grid-template-columns:1fr}}
  .modeCard{
    padding:14px;
    border-radius:16px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    cursor:pointer;
    transition: transform .08s ease, border-color .12s ease, background .12s ease;
  }
  .modeCard:hover{border-color:rgba(124,140,255,.55);}
  .modeCard:active{transform:scale(.99);}
  .modeTitle{font-weight:950; letter-spacing:.2px}
  .modeDesc{font-size:12px; color:var(--muted); margin-top:6px; line-height:1.35}
  .locked{opacity:.55; cursor:not-allowed;}
  .pill{display:inline-block; padding:5px 10px; border-radius:999px; font-size:12px; font-weight:950;
         background:rgba(255,255,255,.06); border:1px solid var(--line); color:var(--muted);}
  .pill.good{color:rgba(44,255,136,.9)}
  .pill.warn{color:rgba(255,209,102,.95)}
  .pill.bad{color:rgba(255,75,75,.9)}
  .qaTop{display:flex; justify-content:space-between; align-items:flex-start; gap:10px; flex-wrap:wrap}
  .tags{display:flex; gap:8px; flex-wrap:wrap}
  .timerBig{display:none; font-size:56px; font-weight:1000; letter-spacing:1px; color:var(--warn); line-height:1}
  h2{margin:12px 0 0; font-size:22px; letter-spacing:.2px}
  .answers{display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:14px;}
  @media(max-width:720px){ .answers{grid-template-columns:1fr} }
  .ans{
    background:rgba(255,255,255,.04);
    border:1px solid var(--line);
    border-radius:14px;
    padding:14px 14px;
    cursor:pointer;
    user-select:none;
    font-weight:950;
    letter-spacing:.2px;
    transition:transform .08s ease, border-color .12s ease, background .12s ease;
  }
  .ans:hover{border-color:rgba(124,140,255,.6);}
  .ans:active{transform:scale(.99);}
  .ans.lock{pointer-events:none;opacity:.92}
  .ans.correct{border-color:rgba(44,255,136,.8); background:rgba(44,255,136,.12);}
  .ans.wrong{border-color:rgba(255,75,75,.8); background:rgba(255,75,75,.10);}
  .ans.hide{display:none}
  .footerRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:14px}
  .note{color:var(--muted); font-size:12px; line-height:1.4}
  .toast{
    position:fixed;
    left:50%;
    bottom:20px;
    transform:translateX(-50%);
    background:rgba(18,26,42,.95);
    border:1px solid var(--line);
    color:var(--text);
    padding:10px 12px;
    border-radius:12px;
    box-shadow:0 18px 50px rgba(0,0,0,.45);
    display:none;
    z-index:999;
    font-weight:900;
    letter-spacing:.2px;
  }
  .toast.show{display:block;}
  .shake{animation:shake .18s linear 2;}
  @keyframes shake{
    0%{transform:translateX(0)}
    25%{transform:translateX(-6px)}
    50%{transform:translateX(6px)}
    75%{transform:translateX(-4px)}
    100%{transform:translateX(0)}
  }
  .achList{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px}
  @media(max-width:720px){ .achList{grid-template-columns:1fr} }
  .ach{
    padding:12px;
    border-radius:14px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    display:flex; gap:10px; align-items:flex-start;
  }
  .achIcon{font-size:18px; width:28px}
  .achTitle{font-weight:950}
  .achDesc{font-size:12px; color:var(--muted); margin-top:4px; line-height:1.35}
  .achLocked{opacity:.55}
  .smallBtn{padding:8px 10px; font-weight:950}
</style>
</head>
<body>
<div class="app">
  <div class="top">
    <div class="brand">
      <h1>Geo Kombat</h1>
      <div class="sub">Duolingo-style progression · all countries · clean & serious</div>
    </div>
    <div class="hud">
      <div class="chip">Level <b id="level">1</b></div>
      <div class="chip">XP <b id="xp">0</b></div>
      <div class="chip">Streak <b id="streak">0</b> <span class="muted">(best <b id="bestStreak">0</b>)</span></div>
      <div class="chip" title="Progress to next level">
        <div class="progressBar"><div class="progressFill" id="xpFill"></div></div>
      </div>
      <button class="smallBtn" id="btnMenu" type="button">Menu</button>
    </div>
  </div>

  <div class="screen active" id="screenMenu">
    <div class="grid2">
      <div class="card">
        <div class="qaTop">
          <div>
            <div class="muted" style="font-size:12px;font-weight:900">TODAY</div>
            <div class="modeTitle" style="margin-top:2px">Daily Challenge</div>
            <div class="modeDesc">A short run designed to build consistency. Earn bonus XP and a badge when completed.</div>
          </div>
          <div class="pill warn" id="dailyTag">Not completed</div>
        </div>
        <div class="divider"></div>
        <div class="footerRow">
          <button class="primary" id="btnDaily" type="button">Start Daily</button>
          <button id="btnAchievements" type="button">Achievements</button>
          <button id="btnResetProgress" type="button" class="ghost">Reset progress</button>
        </div>
        <div class="note" style="margin-top:10px">Countries loaded: <b id="count"></b>. Lifeline removes 2 wrong answers. You can earn extra lifelines via streaks.</div>
      </div>

      <div class="card">
        <div class="qaTop">
          <div>
            <div class="muted" style="font-size:12px;font-weight:900">SETTINGS</div>
            <div class="modeTitle" style="margin-top:2px">Exam length</div>
            <div class="modeDesc">Choose how many questions the exam contains.</div>
          </div>
        </div>
        <div class="divider"></div>
        <div class="footerRow">
          <select id="examCount">
            <option value="10">10 questions</option>
            <option value="20" selected>20 questions</option>
            <option value="30">30 questions</option>
            <option value="40">40 questions</option>
          </select>
          <span class="pill" id="unlockHint">Survival unlocks at Level 3 · Time Attack at Level 5</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="muted" style="font-size:12px;font-weight:900">MODES</div>
      <div class="modeGrid" style="margin-top:10px">
        <div class="modeCard" id="modePractice" tabindex="0" role="button" aria-label="Practice mode">
          <div class="qaTop">
            <div>
              <div class="modeTitle">Practice</div>
              <div class="modeDesc">No pressure. Learn with streaks, XP and gentle penalties.</div>
            </div>
            <div class="pill good">+XP</div>
          </div>
        </div>

        <div class="modeCard" id="modeExam" tabindex="0" role="button" aria-label="Exam mode">
          <div class="qaTop">
            <div>
              <div class="modeTitle">Exam</div>
              <div class="modeDesc">Fixed number of questions. Final score shown as 0–100, with mistake review.</div>
            </div>
            <div class="pill warn">Score</div>
          </div>
        </div>

        <div class="modeCard locked" id="modeTime" tabindex="0" role="button" aria-label="Time Attack mode">
          <div class="qaTop">
            <div>
              <div class="modeTitle">Time Attack</div>
              <div class="modeDesc">Answer as many as possible before time runs out. Timer is big for pressure.</div>
            </div>
            <div class="pill bad">Fast</div>
          </div>
          <div class="note" style="margin-top:10px">Unlocks at Level 5.</div>
        </div>

        <div class="modeCard locked" id="modeSurvival" tabindex="0" role="button" aria-label="Survival mode">
          <div class="qaTop">
            <div>
              <div class="modeTitle">Survival</div>
              <div class="modeDesc">One mistake ends the run. High risk, high XP.</div>
            </div>
            <div class="pill bad">Hard</div>
          </div>
          <div class="note" style="margin-top:10px">Unlocks at Level 3.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="screen" id="screenGame">
    <div class="card">
      <div class="qaTop">
        <div>
          <div class="tags" id="tags"></div>
          <div class="note" id="progress"></div>
        </div>
        <div class="timerBig" id="timer"></div>
        <div class="tags">
          <span class="chip">Lifelines: <b id="lifeCount">3</b></span>
          <button id="btnLifeline" type="button">Lifeline</button>
        </div>
      </div>

      <h2 id="question"></h2>
      <div class="answers" id="answers"></div>

      <div class="footerRow">
        <button class="primary" id="btnNext" type="button">Next</button>
        <button id="btnRestart" type="button">Restart</button>
        <div class="note" id="hint"></div>
      </div>
    </div>
  </div>

  <div class="screen" id="screenResults">
    <div class="card">
      <div class="qaTop">
        <div>
          <div class="modeTitle">Results</div>
          <div class="modeDesc" id="scoreLine"></div>
        </div>
        <div class="pill" id="rewardLine">+0 XP</div>
      </div>
      <div class="divider"></div>
      <div class="footerRow">
        <button class="primary" id="btnReview" type="button">Review mistakes</button>
        <button id="btnRestart2" type="button">Restart</button>
      </div>
      <div id="review"></div>
    </div>
  </div>

  <div class="screen" id="screenAchievements">
    <div class="card">
      <div class="qaTop">
        <div>
          <div class="modeTitle">Achievements</div>
          <div class="modeDesc">Clean rewards that keep it game-like (not childish).</div>
        </div>
        <button id="btnBackFromAch" type="button">Back</button>
      </div>
      <div class="divider"></div>
      <div class="achList" id="achList"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script id="countriesData" type="application/json">[{"name":"Aruba","code":"AW","continent":"Americas","capital":"Oranjestad","gov":"Republic","demonym":"Aruban","languages":["Dutch","Papiamento"],"economy":null,"altCities":[]},{"name":"Afghanistan","code":"AF","continent":"Asia","capital":"Kabul","gov":"Republic","demonym":"Afghan","languages":["Dari","Pashto","Turkmen"],"economy":null,"altCities":[]},{"name":"Angola","code":"AO","continent":"Africa","capital":"Luanda","gov":"Republic","demonym":"Angolan","languages":["Portuguese"],"economy":null,"altCities":[]},{"name":"Anguilla","code":"AI","continent":"Americas","capital":"The Valley","gov":"Republic","demonym":"Anguillian","languages":["English"],"economy":null,"altCities":[]},{"name":"Åland Islands","code":"AX","continent":"Europe","capital":"Mariehamn","gov":"Republic","demonym":"Ålandish","languages":["Swedish"],"economy":null,"altCities":[]},{"name":"Albania","code":"AL","continent":"Europe","capital":"Tirana","gov":"Republic","demonym":"Albanian","languages":["Albanian"],"economy":null,"altCities":[]},{"name":"Andorra","code":"AD","continent":"Europe","capital":"Andorra la Vella","gov":"Constitutional Monarchy","demonym":"Andorran","languages":["Catalan"],"economy":null,"altCities":[]},{"name":"United Arab Emirates","code":"AE","continent":"Asia","capital":"Abu Dhabi","gov":"Absolute Monarchy","demonym":"Emirati","languages":["Arabic"],"economy":"Oil and tourism","altCities":[]},{"name":"Argentina","code":"AR","continent":"Americas","capital":"Buenos Aires","gov":"Federation","demonym":"Argentine","languages":["Guaraní","Spanish"],"economy":null,"altCities":[]},{"name":"Armenia","code":"AM","continent":"Asia","capital":"Yerevan","gov":"Republic","demonym":"Armenian","languages":["Armenian"],"economy":null,"altCities":[]},{"name":"American Samoa","code":"AS","continent":"Oceania","capital":"Pago Pago","gov":"Republic","demonym":"American Samoan","languages":["English","Samoan"],"economy":null,"altCities":[]},{"name":"Antarctica","code":"AQ","continent":"Antarctic","capital":null,"gov":"Republic","demonym":"Antarctican","languages":[],"economy":null,"altCities":[]},{"name":"French Southern and Antarctic Lands","code":"TF","continent":"Antarctic","capital":"Port-aux-Français","gov":"Republic","demonym":"French","languages":["French"],"economy":null,"altCities":[]},{"name":"Antigua and Barbuda","code":"AG","continent":"Americas","capital":"Saint John's","gov":"Constitutional Monarchy","demonym":"Antiguan, Barbudan","languages":["English"],"economy":null,"altCities":[]},{"name":"Australia","code":"AU","continent":"Oceania","capital":"Canberra","gov":"Constitutional Monarchy","demonym":"Australian","languages":["English"],"economy":"Minerals and wool","altCities":[]},{"name":"Austria","code":"AT","continent":"Europe","capital":"Vienna","gov":"Federation","demonym":"Austrian","languages":["Austro-Bavarian German"],"economy":null,"altCities":[]},{"name":"Azerbaijan","code":"AZ","continent":"Asia","capital":"Baku","gov":"Republic","demonym":"Azerbaijani","languages":["Azerbaijani","Russian"],"economy":null,"altCities":[]},{"name":"Burundi","code":"BI","continent":"Africa","capital":"Gitega","gov":"Republic","demonym":"Burundian","languages":["French","Kirundi"],"economy":null,"altCities":[]},{"name":"Belgium","code":"BE","continent":"Europe","capital":"Brussels","gov":"Constitutional Monarchy","demonym":"Belgian","languages":["Dutch","French","German"],"economy":null,"altCities":[]},{"name":"Benin","code":"BJ","continent":"Africa","capital":"Porto-Novo","gov":"Republic","demonym":"Beninese","languages":["French"],"economy":null,"altCities":[]},{"name":"Burkina Faso","code":"BF","continent":"Africa","capital":"Ouagadougou","gov":"Republic","demonym":"Burkinabe","languages":["French"],"economy":null,"altCities":[]},{"name":"Bangladesh","code":"BD","continent":"Asia","capital":"Dhaka","gov":"Republic","demonym":"Bangladeshi","languages":["Bengali"],"economy":null,"altCities":[]},{"name":"Bulgaria","code":"BG","continent":"Europe","capital":"Sofia","gov":"Republic","demonym":"Bulgarian","languages":["Bulgarian"],"economy":null,"altCities":[]},{"name":"Bahrain","code":"BH","continent":"Asia","capital":"Manama","gov":"Constitutional Monarchy","demonym":"Bahraini","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Bahamas","code":"BS","continent":"Americas","capital":"Nassau","gov":"Constitutional Monarchy","demonym":"Bahamian","languages":["English"],"economy":null,"altCities":[]},{"name":"Bosnia and Herzegovina","code":"BA","continent":"Europe","capital":"Sarajevo","gov":"Republic","demonym":"Bosnian, Herzegovinian","languages":["Bosnian","Croatian","Serbian"],"economy":null,"altCities":[]},{"name":"Saint Barthélemy","code":"BL","continent":"Americas","capital":"Gustavia","gov":"Republic","demonym":"Saint Barthélemy Islander","languages":["French"],"economy":null,"altCities":[]},{"name":"Saint Helena, Ascension and Tristan da Cunha","code":"SH","continent":"Africa","capital":"Jamestown","gov":"Republic","demonym":"Saint Helenian","languages":["English"],"economy":null,"altCities":[]},{"name":"Belarus","code":"BY","continent":"Europe","capital":"Minsk","gov":"Republic","demonym":"Belarusian","languages":["Belarusian","Russian"],"economy":null,"altCities":[]},{"name":"Belize","code":"BZ","continent":"Americas","capital":"Belmopan","gov":"Constitutional Monarchy","demonym":"Belizean","languages":["Belizean Creole","English","Spanish"],"economy":null,"altCities":[]},{"name":"Bermuda","code":"BM","continent":"Americas","capital":"Hamilton","gov":"Republic","demonym":"Bermudian","languages":["English"],"economy":null,"altCities":[]},{"name":"Bolivia","code":"BO","continent":"Americas","capital":"Sucre","gov":"Republic","demonym":"Bolivian","languages":["Aymara","Guaraní","Quechua","Spanish"],"economy":null,"altCities":[]},{"name":"Caribbean Netherlands","code":"BQ","continent":"Americas","capital":"Kralendijk","gov":"Republic","demonym":"Dutch","languages":["English","Dutch","Papiamento"],"economy":null,"altCities":[]},{"name":"Brazil","code":"BR","continent":"Americas","capital":"Brasília","gov":"Federation","demonym":"Brazilian","languages":["Portuguese"],"economy":"Coffee and soybeans","altCities":[]},{"name":"Barbados","code":"BB","continent":"Americas","capital":"Bridgetown","gov":"Constitutional Monarchy","demonym":"Barbadian","languages":["English"],"economy":null,"altCities":[]},{"name":"Brunei","code":"BN","continent":"Asia","capital":"Bandar Seri Begawan","gov":"Absolute Monarchy","demonym":"Bruneian","languages":["Malay"],"economy":null,"altCities":[]},{"name":"Bhutan","code":"BT","continent":"Asia","capital":"Thimphu","gov":"Constitutional Monarchy","demonym":"Bhutanese","languages":["Dzongkha"],"economy":null,"altCities":[]},{"name":"Bouvet Island","code":"BV","continent":"Antarctic","capital":null,"gov":"Republic","demonym":"","languages":["Norwegian"],"economy":null,"altCities":[]},{"name":"Botswana","code":"BW","continent":"Africa","capital":"Gaborone","gov":"Republic","demonym":"Motswana","languages":["English","Tswana"],"economy":null,"altCities":[]},{"name":"Central African Republic","code":"CF","continent":"Africa","capital":"Bangui","gov":"Republic","demonym":"Central African","languages":["French","Sango"],"economy":null,"altCities":[]},{"name":"Canada","code":"CA","continent":"Americas","capital":"Ottawa","gov":"Constitutional Monarchy","demonym":"Canadian","languages":["English","French"],"economy":"Timber and oil","altCities":[]},{"name":"Cocos (Keeling) Islands","code":"CC","continent":"Oceania","capital":"West Island","gov":"Republic","demonym":"Cocos Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Switzerland","code":"CH","continent":"Europe","capital":"Bern","gov":"Federation","demonym":"Swiss","languages":["German","French","Italian","Romansh"],"economy":null,"altCities":[]},{"name":"Chile","code":"CL","continent":"Americas","capital":"Santiago","gov":"Republic","demonym":"Chilean","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"China","code":"CN","continent":"Asia","capital":"Beijing","gov":"Republic","demonym":"Chinese","languages":["Chinese"],"economy":"Manufacturing and electronics","altCities":[]},{"name":"Ivory Coast","code":"CI","continent":"Africa","capital":"Yamoussoukro","gov":"Republic","demonym":"Ivorian","languages":["French"],"economy":null,"altCities":[]},{"name":"Cameroon","code":"CM","continent":"Africa","capital":"Yaoundé","gov":"Republic","demonym":"Cameroonian","languages":["English","French"],"economy":null,"altCities":[]},{"name":"DR Congo","code":"CD","continent":"Africa","capital":"Kinshasa","gov":"Republic","demonym":"Congolese","languages":["French","Kikongo","Lingala","Tshiluba","Swahili"],"economy":null,"altCities":[]},{"name":"Congo","code":"CG","continent":"Africa","capital":"Brazzaville","gov":"Republic","demonym":"Congolese","languages":["French","Kikongo","Lingala"],"economy":null,"altCities":[]},{"name":"Cook Islands","code":"CK","continent":"Oceania","capital":"Avarua","gov":"Republic","demonym":"Cook Islander","languages":["English","Cook Islands Māori"],"economy":null,"altCities":[]},{"name":"Colombia","code":"CO","continent":"Americas","capital":"Bogotá","gov":"Republic","demonym":"Colombian","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Comoros","code":"KM","continent":"Africa","capital":"Moroni","gov":"Republic","demonym":"Comoran","languages":["Arabic","French","Comorian"],"economy":null,"altCities":[]},{"name":"Cape Verde","code":"CV","continent":"Africa","capital":"Praia","gov":"Republic","demonym":"Cape Verdian","languages":["Portuguese"],"economy":null,"altCities":[]},{"name":"Costa Rica","code":"CR","continent":"Americas","capital":"San José","gov":"Republic","demonym":"Costa Rican","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Cuba","code":"CU","continent":"Americas","capital":"Havana","gov":"Republic","demonym":"Cuban","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Curaçao","code":"CW","continent":"Americas","capital":"Willemstad","gov":"Republic","demonym":"Curaçaoan","languages":["English","Dutch","Papiamento"],"economy":null,"altCities":[]},{"name":"Christmas Island","code":"CX","continent":"Oceania","capital":"Flying Fish Cove","gov":"Republic","demonym":"Christmas Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Cayman Islands","code":"KY","continent":"Americas","capital":"George Town","gov":"Republic","demonym":"Caymanian","languages":["English"],"economy":null,"altCities":[]},{"name":"Cyprus","code":"CY","continent":"Europe","capital":"Nicosia","gov":"Republic","demonym":"Cypriot","languages":["Greek","Turkish"],"economy":null,"altCities":[]},{"name":"Czechia","code":"CZ","continent":"Europe","capital":"Prague","gov":"Republic","demonym":"Czech","languages":["Czech","Slovak"],"economy":null,"altCities":[]},{"name":"Germany","code":"DE","continent":"Europe","capital":"Berlin","gov":"Federation","demonym":"German","languages":["German"],"economy":"Cars and machinery","altCities":[]},{"name":"Djibouti","code":"DJ","continent":"Africa","capital":"Djibouti","gov":"Republic","demonym":"Djibouti","languages":["Arabic","French"],"economy":null,"altCities":[]},{"name":"Dominica","code":"DM","continent":"Americas","capital":"Roseau","gov":"Republic","demonym":"Dominican","languages":["English"],"economy":null,"altCities":[]},{"name":"Denmark","code":"DK","continent":"Europe","capital":"Copenhagen","gov":"Constitutional Monarchy","demonym":"Danish","languages":["Danish"],"economy":null,"altCities":[]},{"name":"Dominican Republic","code":"DO","continent":"Americas","capital":"Santo Domingo","gov":"Republic","demonym":"Dominican","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Algeria","code":"DZ","continent":"Africa","capital":"Algiers","gov":"Republic","demonym":"Algerian","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Ecuador","code":"EC","continent":"Americas","capital":"Quito","gov":"Republic","demonym":"Ecuadorean","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Egypt","code":"EG","continent":"Africa","capital":"Cairo","gov":"Republic","demonym":"Egyptian","languages":["Arabic"],"economy":"Tourism and farming","altCities":[]},{"name":"Eritrea","code":"ER","continent":"Africa","capital":"Asmara","gov":"Republic","demonym":"Eritrean","languages":["Arabic","English","Tigrinya"],"economy":null,"altCities":[]},{"name":"Western Sahara","code":"EH","continent":"Africa","capital":"El Aaiún","gov":"Republic","demonym":"Sahrawi","languages":["Berber","Hassaniya","Spanish"],"economy":null,"altCities":[]},{"name":"Spain","code":"ES","continent":"Europe","capital":"Madrid","gov":"Constitutional Monarchy","demonym":"Spanish","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Estonia","code":"EE","continent":"Europe","capital":"Tallinn","gov":"Republic","demonym":"Estonian","languages":["Estonian"],"economy":null,"altCities":[]},{"name":"Ethiopia","code":"ET","continent":"Africa","capital":"Addis Ababa","gov":"Federation","demonym":"Ethiopian","languages":["Amharic"],"economy":null,"altCities":[]},{"name":"Finland","code":"FI","continent":"Europe","capital":"Helsinki","gov":"Republic","demonym":"Finnish","languages":["Finnish","Swedish"],"economy":null,"altCities":[]},{"name":"Fiji","code":"FJ","continent":"Oceania","capital":"Suva","gov":"Republic","demonym":"Fijian","languages":["English","Fijian","Fiji Hindi"],"economy":null,"altCities":[]},{"name":"Falkland Islands","code":"FK","continent":"Americas","capital":"Stanley","gov":"Republic","demonym":"Falkland Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"France","code":"FR","continent":"Europe","capital":"Paris","gov":"Republic","demonym":"French","languages":["French"],"economy":null,"altCities":[]},{"name":"Faroe Islands","code":"FO","continent":"Europe","capital":"Tórshavn","gov":"Republic","demonym":"Faroese","languages":["Danish","Faroese"],"economy":null,"altCities":[]},{"name":"Micronesia","code":"FM","continent":"Oceania","capital":"Palikir","gov":"Republic","demonym":"Micronesian","languages":["English"],"economy":null,"altCities":[]},{"name":"Gabon","code":"GA","continent":"Africa","capital":"Libreville","gov":"Republic","demonym":"Gabonese","languages":["French"],"economy":null,"altCities":[]},{"name":"United Kingdom","code":"GB","continent":"Europe","capital":"London","gov":"Constitutional Monarchy","demonym":"British","languages":["English"],"economy":"Finance and services","altCities":[]},{"name":"Georgia","code":"GE","continent":"Asia","capital":"Tbilisi","gov":"Republic","demonym":"Georgian","languages":["Georgian"],"economy":null,"altCities":[]},{"name":"Guernsey","code":"GG","continent":"Europe","capital":"St. Peter Port","gov":"Republic","demonym":"Channel Islander","languages":["English","French","Guernésiais"],"economy":null,"altCities":[]},{"name":"Ghana","code":"GH","continent":"Africa","capital":"Accra","gov":"Republic","demonym":"Ghanaian","languages":["English"],"economy":null,"altCities":[]},{"name":"Gibraltar","code":"GI","continent":"Europe","capital":"Gibraltar","gov":"Republic","demonym":"Gibraltar","languages":["English"],"economy":null,"altCities":[]},{"name":"Guinea","code":"GN","continent":"Africa","capital":"Conakry","gov":"Republic","demonym":"Guinean","languages":["French"],"economy":null,"altCities":[]},{"name":"Guadeloupe","code":"GP","continent":"Americas","capital":"Basse-Terre","gov":"Republic","demonym":"Guadeloupian","languages":["French"],"economy":null,"altCities":[]},{"name":"Gambia","code":"GM","continent":"Africa","capital":"Banjul","gov":"Republic","demonym":"Gambian","languages":["English"],"economy":null,"altCities":[]},{"name":"Guinea-Bissau","code":"GW","continent":"Africa","capital":"Bissau","gov":"Republic","demonym":"Guinea-Bissauan","languages":["Portuguese","Upper Guinea Creole"],"economy":null,"altCities":[]},{"name":"Equatorial Guinea","code":"GQ","continent":"Africa","capital":"Malabo","gov":"Republic","demonym":"Equatorial Guinean","languages":["French","Portuguese","Spanish"],"economy":null,"altCities":[]},{"name":"Greece","code":"GR","continent":"Europe","capital":"Athens","gov":"Republic","demonym":"Greek","languages":["Greek"],"economy":null,"altCities":[]},{"name":"Grenada","code":"GD","continent":"Americas","capital":"St. George's","gov":"Constitutional Monarchy","demonym":"Grenadian","languages":["English"],"economy":null,"altCities":[]},{"name":"Greenland","code":"GL","continent":"Americas","capital":"Nuuk","gov":"Republic","demonym":"Greenlandic","languages":["Greenlandic"],"economy":null,"altCities":[]},{"name":"Guatemala","code":"GT","continent":"Americas","capital":"Guatemala City","gov":"Republic","demonym":"Guatemalan","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"French Guiana","code":"GF","continent":"Americas","capital":"Cayenne","gov":"Republic","demonym":"Guianan","languages":["French"],"economy":null,"altCities":[]},{"name":"Guam","code":"GU","continent":"Oceania","capital":"Hagåtña","gov":"Republic","demonym":"Guamanian","languages":["Chamorro","English","Spanish"],"economy":null,"altCities":[]},{"name":"Guyana","code":"GY","continent":"Americas","capital":"Georgetown","gov":"Republic","demonym":"Guyanese","languages":["English"],"economy":null,"altCities":[]},{"name":"Hong Kong","code":"HK","continent":"Asia","capital":"City of Victoria","gov":"Republic","demonym":"Hong Konger","languages":["English","Chinese"],"economy":null,"altCities":[]},{"name":"Heard Island and McDonald Islands","code":"HM","continent":"Antarctic","capital":null,"gov":"Republic","demonym":"Heard and McDonald Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Honduras","code":"HN","continent":"Americas","capital":"Tegucigalpa","gov":"Republic","demonym":"Honduran","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Croatia","code":"HR","continent":"Europe","capital":"Zagreb","gov":"Republic","demonym":"Croatian","languages":["Croatian"],"economy":null,"altCities":[]},{"name":"Haiti","code":"HT","continent":"Americas","capital":"Port-au-Prince","gov":"Republic","demonym":"Haitian","languages":["French","Haitian Creole"],"economy":null,"altCities":[]},{"name":"Hungary","code":"HU","continent":"Europe","capital":"Budapest","gov":"Republic","demonym":"Hungarian","languages":["Hungarian"],"economy":null,"altCities":[]},{"name":"Indonesia","code":"ID","continent":"Asia","capital":"Jakarta","gov":"Republic","demonym":"Indonesian","languages":["Indonesian"],"economy":null,"altCities":[]},{"name":"Isle of Man","code":"IM","continent":"Europe","capital":"Douglas","gov":"Republic","demonym":"Manx","languages":["English","Manx"],"economy":null,"altCities":[]},{"name":"India","code":"IN","continent":"Asia","capital":"New Delhi","gov":"Federation","demonym":"Indian","languages":["English","Hindi","Tamil"],"economy":"IT services and textiles","altCities":[]},{"name":"British Indian Ocean Territory","code":"IO","continent":"Africa","capital":"Diego Garcia","gov":"Republic","demonym":"Indian","languages":["English"],"economy":null,"altCities":[]},{"name":"Ireland","code":"IE","continent":"Europe","capital":"Dublin","gov":"Republic","demonym":"Irish","languages":["English","Irish"],"economy":null,"altCities":[]},{"name":"Iran","code":"IR","continent":"Asia","capital":"Tehran","gov":"Republic","demonym":"Iranian","languages":["Persian (Farsi)"],"economy":null,"altCities":[]},{"name":"Iraq","code":"IQ","continent":"Asia","capital":"Baghdad","gov":"Republic","demonym":"Iraqi","languages":["Arabic","Aramaic","Sorani"],"economy":null,"altCities":[]},{"name":"Iceland","code":"IS","continent":"Europe","capital":"Reykjavik","gov":"Republic","demonym":"Icelander","languages":["Icelandic"],"economy":null,"altCities":[]},{"name":"Israel","code":"IL","continent":"Asia","capital":"Jerusalem","gov":"Republic","demonym":"Israeli","languages":["Hebrew","Arabic"],"economy":null,"altCities":[]},{"name":"Italy","code":"IT","continent":"Europe","capital":"Rome","gov":"Republic","demonym":"Italian","languages":["Italian"],"economy":null,"altCities":[]},{"name":"Jamaica","code":"JM","continent":"Americas","capital":"Kingston","gov":"Constitutional Monarchy","demonym":"Jamaican","languages":["English","Jamaican Patois"],"economy":null,"altCities":[]},{"name":"Jersey","code":"JE","continent":"Europe","capital":"Saint Helier","gov":"Republic","demonym":"Channel Islander","languages":["English","French","Jèrriais"],"economy":null,"altCities":[]},{"name":"Jordan","code":"JO","continent":"Asia","capital":"Amman","gov":"Constitutional Monarchy","demonym":"Jordanian","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Japan","code":"JP","continent":"Asia","capital":"Tokyo","gov":"Constitutional Monarchy","demonym":"Japanese","languages":["Japanese"],"economy":"Cars and electronics","altCities":["Osaka","Yokohama","Nagoya"]},{"name":"Kazakhstan","code":"KZ","continent":"Asia","capital":"Astana","gov":"Republic","demonym":"Kazakhstani","languages":["Kazakh","Russian"],"economy":null,"altCities":[]},{"name":"Kenya","code":"KE","continent":"Africa","capital":"Nairobi","gov":"Republic","demonym":"Kenyan","languages":["English","Swahili"],"economy":"Tea and coffee farming","altCities":[]},{"name":"Kyrgyzstan","code":"KG","continent":"Asia","capital":"Bishkek","gov":"Republic","demonym":"Kirghiz","languages":["Kyrgyz","Russian"],"economy":null,"altCities":[]},{"name":"Cambodia","code":"KH","continent":"Asia","capital":"Phnom Penh","gov":"Constitutional Monarchy","demonym":"Cambodian","languages":["Khmer"],"economy":null,"altCities":[]},{"name":"Kiribati","code":"KI","continent":"Oceania","capital":"South Tarawa","gov":"Republic","demonym":"I-Kiribati","languages":["English","Gilbertese"],"economy":null,"altCities":[]},{"name":"Saint Kitts and Nevis","code":"KN","continent":"Americas","capital":"Basseterre","gov":"Constitutional Monarchy","demonym":"Kittitian or Nevisian","languages":["English"],"economy":null,"altCities":[]},{"name":"South Korea","code":"KR","continent":"Asia","capital":"Seoul","gov":"Republic","demonym":"South Korean","languages":["Korean"],"economy":null,"altCities":[]},{"name":"Kosovo","code":"XK","continent":"Europe","capital":"Pristina","gov":"Republic","demonym":"Kosovar","languages":["Albanian","Serbian"],"economy":null,"altCities":[]},{"name":"Kuwait","code":"KW","continent":"Asia","capital":"Kuwait City","gov":"Constitutional Monarchy","demonym":"Kuwaiti","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Laos","code":"LA","continent":"Asia","capital":"Vientiane","gov":"Republic","demonym":"Laotian","languages":["Lao"],"economy":null,"altCities":[]},{"name":"Lebanon","code":"LB","continent":"Asia","capital":"Beirut","gov":"Republic","demonym":"Lebanese","languages":["Arabic","French"],"economy":null,"altCities":[]},{"name":"Liberia","code":"LR","continent":"Africa","capital":"Monrovia","gov":"Republic","demonym":"Liberian","languages":["English"],"economy":null,"altCities":[]},{"name":"Libya","code":"LY","continent":"Africa","capital":"Tripoli","gov":"Republic","demonym":"Libyan","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Saint Lucia","code":"LC","continent":"Americas","capital":"Castries","gov":"Constitutional Monarchy","demonym":"Saint Lucian","languages":["English"],"economy":null,"altCities":[]},{"name":"Liechtenstein","code":"LI","continent":"Europe","capital":"Vaduz","gov":"Constitutional Monarchy","demonym":"Liechtensteiner","languages":["German"],"economy":null,"altCities":[]},{"name":"Sri Lanka","code":"LK","continent":"Asia","capital":"Colombo","gov":"Republic","demonym":"Sri Lankan","languages":["Sinhala","Tamil"],"economy":null,"altCities":[]},{"name":"Lesotho","code":"LS","continent":"Africa","capital":"Maseru","gov":"Constitutional Monarchy","demonym":"Mosotho","languages":["English","Sotho"],"economy":null,"altCities":[]},{"name":"Lithuania","code":"LT","continent":"Europe","capital":"Vilnius","gov":"Republic","demonym":"Lithuanian","languages":["Lithuanian"],"economy":null,"altCities":[]},{"name":"Luxembourg","code":"LU","continent":"Europe","capital":"Luxembourg","gov":"Constitutional Monarchy","demonym":"Luxembourger","languages":["German","French","Luxembourgish"],"economy":null,"altCities":[]},{"name":"Latvia","code":"LV","continent":"Europe","capital":"Riga","gov":"Republic","demonym":"Latvian","languages":["Latvian"],"economy":null,"altCities":[]},{"name":"Macau","code":"MO","continent":"Asia","capital":null,"gov":"Republic","demonym":"Macanese","languages":["Portuguese","Chinese"],"economy":null,"altCities":[]},{"name":"Saint Martin","code":"MF","continent":"Americas","capital":"Marigot","gov":"Republic","demonym":"Saint Martin Islander","languages":["French"],"economy":null,"altCities":[]},{"name":"Morocco","code":"MA","continent":"Africa","capital":"Rabat","gov":"Constitutional Monarchy","demonym":"Moroccan","languages":["Arabic","Berber"],"economy":null,"altCities":[]},{"name":"Monaco","code":"MC","continent":"Europe","capital":"Monaco","gov":"Constitutional Monarchy","demonym":"Monegasque","languages":["French"],"economy":null,"altCities":[]},{"name":"Moldova","code":"MD","continent":"Europe","capital":"Chișinău","gov":"Republic","demonym":"Moldovan","languages":["Moldavian"],"economy":null,"altCities":[]},{"name":"Madagascar","code":"MG","continent":"Africa","capital":"Antananarivo","gov":"Republic","demonym":"Malagasy","languages":["French","Malagasy"],"economy":null,"altCities":[]},{"name":"Maldives","code":"MV","continent":"Asia","capital":"Malé","gov":"Republic","demonym":"Maldivan","languages":["Maldivian"],"economy":null,"altCities":[]},{"name":"Mexico","code":"MX","continent":"Americas","capital":"Mexico City","gov":"Federation","demonym":"Mexican","languages":["Spanish"],"economy":"Oil and cars","altCities":["Guadalajara","Monterrey","Puebla"]},{"name":"Marshall Islands","code":"MH","continent":"Oceania","capital":"Majuro","gov":"Republic","demonym":"Marshallese","languages":["English","Marshallese"],"economy":null,"altCities":[]},{"name":"North Macedonia","code":"MK","continent":"Europe","capital":"Skopje","gov":"Republic","demonym":"Macedonian","languages":["Macedonian"],"economy":null,"altCities":[]},{"name":"Mali","code":"ML","continent":"Africa","capital":"Bamako","gov":"Republic","demonym":"Malian","languages":["French"],"economy":null,"altCities":[]},{"name":"Malta","code":"MT","continent":"Europe","capital":"Valletta","gov":"Republic","demonym":"Maltese","languages":["English","Maltese"],"economy":null,"altCities":[]},{"name":"Myanmar","code":"MM","continent":"Asia","capital":"Naypyidaw","gov":"Republic","demonym":"Burmese","languages":["Burmese"],"economy":null,"altCities":[]},{"name":"Montenegro","code":"ME","continent":"Europe","capital":"Podgorica","gov":"Republic","demonym":"Montenegrin","languages":["Montenegrin"],"economy":null,"altCities":[]},{"name":"Mongolia","code":"MN","continent":"Asia","capital":"Ulan Bator","gov":"Republic","demonym":"Mongolian","languages":["Mongolian"],"economy":null,"altCities":[]},{"name":"Northern Mariana Islands","code":"MP","continent":"Oceania","capital":"Saipan","gov":"Republic","demonym":"American","languages":["Carolinian","Chamorro","English"],"economy":null,"altCities":[]},{"name":"Mozambique","code":"MZ","continent":"Africa","capital":"Maputo","gov":"Republic","demonym":"Mozambican","languages":["Portuguese"],"economy":null,"altCities":[]},{"name":"Mauritania","code":"MR","continent":"Africa","capital":"Nouakchott","gov":"Republic","demonym":"Mauritanian","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Montserrat","code":"MS","continent":"Americas","capital":"Plymouth","gov":"Republic","demonym":"Montserratian","languages":["English"],"economy":null,"altCities":[]},{"name":"Martinique","code":"MQ","continent":"Americas","capital":"Fort-de-France","gov":"Republic","demonym":"Martinican","languages":["French"],"economy":null,"altCities":[]},{"name":"Mauritius","code":"MU","continent":"Africa","capital":"Port Louis","gov":"Republic","demonym":"Mauritian","languages":["English","French","Mauritian Creole"],"economy":null,"altCities":[]},{"name":"Malawi","code":"MW","continent":"Africa","capital":"Lilongwe","gov":"Republic","demonym":"Malawian","languages":["English","Chewa"],"economy":null,"altCities":[]},{"name":"Malaysia","code":"MY","continent":"Asia","capital":"Kuala Lumpur","gov":"Constitutional Monarchy","demonym":"Malaysian","languages":["English","Malay"],"economy":null,"altCities":[]},{"name":"Mayotte","code":"YT","continent":"Africa","capital":"Mamoudzou","gov":"Republic","demonym":"Mahoran","languages":["French"],"economy":null,"altCities":[]},{"name":"Namibia","code":"NA","continent":"Africa","capital":"Windhoek","gov":"Republic","demonym":"Namibian","languages":["Afrikaans","German","English","Herero","Khoekhoe","Kwangali","Lozi","Ndonga","Tswana"],"economy":null,"altCities":[]},{"name":"New Caledonia","code":"NC","continent":"Oceania","capital":"Nouméa","gov":"Republic","demonym":"New Caledonian","languages":["French"],"economy":null,"altCities":[]},{"name":"Niger","code":"NE","continent":"Africa","capital":"Niamey","gov":"Republic","demonym":"Nigerien","languages":["French"],"economy":null,"altCities":[]},{"name":"Norfolk Island","code":"NF","continent":"Oceania","capital":"Kingston","gov":"Republic","demonym":"Norfolk Islander","languages":["English","Norfuk"],"economy":null,"altCities":[]},{"name":"Nigeria","code":"NG","continent":"Africa","capital":"Abuja","gov":"Federation","demonym":"Nigerian","languages":["English","Hausa","Yoruba","Igbo"],"economy":"Oil and gas","altCities":["Lagos","Kano","Ibadan"]},{"name":"Nicaragua","code":"NI","continent":"Americas","capital":"Managua","gov":"Republic","demonym":"Nicaraguan","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Niue","code":"NU","continent":"Oceania","capital":"Alofi","gov":"Republic","demonym":"Niuean","languages":["English","Niuean"],"economy":null,"altCities":[]},{"name":"Netherlands","code":"NL","continent":"Europe","capital":"Amsterdam","gov":"Constitutional Monarchy","demonym":"Dutch","languages":["Dutch"],"economy":null,"altCities":[]},{"name":"Norway","code":"NO","continent":"Europe","capital":"Oslo","gov":"Constitutional Monarchy","demonym":"Norwegian","languages":["Norwegian Nynorsk","Norwegian Bokmål","Sami"],"economy":null,"altCities":[]},{"name":"Nepal","code":"NP","continent":"Asia","capital":"Kathmandu","gov":"Republic","demonym":"Nepalese","languages":["Nepali"],"economy":null,"altCities":[]},{"name":"Nauru","code":"NR","continent":"Oceania","capital":"Yaren","gov":"Republic","demonym":"Nauruan","languages":["English","Nauru"],"economy":null,"altCities":[]},{"name":"New Zealand","code":"NZ","continent":"Oceania","capital":"Wellington","gov":"Constitutional Monarchy","demonym":"New Zealander","languages":["English","Māori","New Zealand Sign Language"],"economy":null,"altCities":[]},{"name":"Oman","code":"OM","continent":"Asia","capital":"Muscat","gov":"Absolute Monarchy","demonym":"Omani","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Pakistan","code":"PK","continent":"Asia","capital":"Islamabad","gov":"Federation","demonym":"Pakistani","languages":["English","Urdu"],"economy":null,"altCities":[]},{"name":"Panama","code":"PA","continent":"Americas","capital":"Panama City","gov":"Republic","demonym":"Panamanian","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"Pitcairn Islands","code":"PN","continent":"Oceania","capital":"Adamstown","gov":"Republic","demonym":"Pitcairn Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Peru","code":"PE","continent":"Americas","capital":"Lima","gov":"Republic","demonym":"Peruvian","languages":["Aymara","Quechua","Spanish"],"economy":null,"altCities":[]},{"name":"Philippines","code":"PH","continent":"Asia","capital":"Manila","gov":"Republic","demonym":"Filipino","languages":["Filipino","English"],"economy":null,"altCities":[]},{"name":"Palau","code":"PW","continent":"Oceania","capital":"Ngerulmud","gov":"Republic","demonym":"Palauan","languages":["English","Palauan"],"economy":null,"altCities":[]},{"name":"Papua New Guinea","code":"PG","continent":"Oceania","capital":"Port Moresby","gov":"Constitutional Monarchy","demonym":"Papua New Guinean","languages":["English","Hiri Motu","Tok Pisin"],"economy":null,"altCities":[]},{"name":"Poland","code":"PL","continent":"Europe","capital":"Warsaw","gov":"Republic","demonym":"Polish","languages":["Polish"],"economy":null,"altCities":[]},{"name":"Puerto Rico","code":"PR","continent":"Americas","capital":"San Juan","gov":"Republic","demonym":"Puerto Rican","languages":["English","Spanish"],"economy":null,"altCities":[]},{"name":"North Korea","code":"KP","continent":"Asia","capital":"Pyongyang","gov":"Republic","demonym":"North Korean","languages":["Korean"],"economy":null,"altCities":[]},{"name":"Portugal","code":"PT","continent":"Europe","capital":"Lisbon","gov":"Republic","demonym":"Portuguese","languages":["Portuguese"],"economy":null,"altCities":[]},{"name":"Paraguay","code":"PY","continent":"Americas","capital":"Asunción","gov":"Republic","demonym":"Paraguayan","languages":["Guaraní","Spanish"],"economy":null,"altCities":[]},{"name":"Palestine","code":"PS","continent":"Asia","capital":"Ramallah","gov":"Republic","demonym":"Palestinian","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"French Polynesia","code":"PF","continent":"Oceania","capital":"Papeetē","gov":"Republic","demonym":"French Polynesian","languages":["French"],"economy":null,"altCities":[]},{"name":"Qatar","code":"QA","continent":"Asia","capital":"Doha","gov":"Absolute Monarchy","demonym":"Qatari","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Réunion","code":"RE","continent":"Africa","capital":"Saint-Denis","gov":"Republic","demonym":"Réunionese","languages":["French"],"economy":null,"altCities":[]},{"name":"Romania","code":"RO","continent":"Europe","capital":"Bucharest","gov":"Republic","demonym":"Romanian","languages":["Romanian"],"economy":null,"altCities":[]},{"name":"Russia","code":"RU","continent":"Europe","capital":"Moscow","gov":"Federation","demonym":"Russian","languages":["Russian"],"economy":"Oil and gas","altCities":[]},{"name":"Rwanda","code":"RW","continent":"Africa","capital":"Kigali","gov":"Republic","demonym":"Rwandan","languages":["English","French","Kinyarwanda"],"economy":null,"altCities":[]},{"name":"Saudi Arabia","code":"SA","continent":"Asia","capital":"Riyadh","gov":"Absolute Monarchy","demonym":"Saudi Arabian","languages":["Arabic"],"economy":"Oil","altCities":[]},{"name":"Sudan","code":"SD","continent":"Africa","capital":"Khartoum","gov":"Republic","demonym":"Sudanese","languages":["Arabic","English"],"economy":null,"altCities":[]},{"name":"Senegal","code":"SN","continent":"Africa","capital":"Dakar","gov":"Republic","demonym":"Senegalese","languages":["French"],"economy":null,"altCities":[]},{"name":"Singapore","code":"SG","continent":"Asia","capital":"Singapore","gov":"Republic","demonym":"Singaporean","languages":["English","Malay","Chinese","Tamil"],"economy":null,"altCities":[]},{"name":"South Georgia","code":"GS","continent":"Antarctic","capital":"King Edward Point","gov":"Republic","demonym":"South Georgian South Sandwich Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Svalbard and Jan Mayen","code":"SJ","continent":"Europe","capital":"Longyearbyen","gov":"Republic","demonym":"Norwegian","languages":["Norwegian"],"economy":null,"altCities":[]},{"name":"Solomon Islands","code":"SB","continent":"Oceania","capital":"Honiara","gov":"Constitutional Monarchy","demonym":"Solomon Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Sierra Leone","code":"SL","continent":"Africa","capital":"Freetown","gov":"Republic","demonym":"Sierra Leonean","languages":["English"],"economy":null,"altCities":[]},{"name":"El Salvador","code":"SV","continent":"Americas","capital":"San Salvador","gov":"Republic","demonym":"Salvadoran","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"San Marino","code":"SM","continent":"Europe","capital":"City of San Marino","gov":"Republic","demonym":"Sammarinese","languages":["Italian"],"economy":null,"altCities":[]},{"name":"Somalia","code":"SO","continent":"Africa","capital":"Mogadishu","gov":"Republic","demonym":"Somali","languages":["Arabic","Somali"],"economy":null,"altCities":[]},{"name":"Saint Pierre and Miquelon","code":"PM","continent":"Americas","capital":"Saint-Pierre","gov":"Republic","demonym":"Saint-Pierrais, Miquelonnais","languages":["French"],"economy":null,"altCities":[]},{"name":"Serbia","code":"RS","continent":"Europe","capital":"Belgrade","gov":"Republic","demonym":"Serbian","languages":["Serbian"],"economy":null,"altCities":[]},{"name":"South Sudan","code":"SS","continent":"Africa","capital":"Juba","gov":"Republic","demonym":"South Sudanese","languages":["English"],"economy":null,"altCities":[]},{"name":"São Tomé and Príncipe","code":"ST","continent":"Africa","capital":"São Tomé","gov":"Republic","demonym":"Sao Tomean","languages":["Portuguese"],"economy":null,"altCities":[]},{"name":"Suriname","code":"SR","continent":"Americas","capital":"Paramaribo","gov":"Republic","demonym":"Surinamer","languages":["Dutch"],"economy":null,"altCities":[]},{"name":"Slovakia","code":"SK","continent":"Europe","capital":"Bratislava","gov":"Republic","demonym":"Slovak","languages":["Slovak"],"economy":null,"altCities":[]},{"name":"Slovenia","code":"SI","continent":"Europe","capital":"Ljubljana","gov":"Republic","demonym":"Slovene","languages":["Slovene"],"economy":null,"altCities":[]},{"name":"Sweden","code":"SE","continent":"Europe","capital":"Stockholm","gov":"Constitutional Monarchy","demonym":"Swedish","languages":["Swedish"],"economy":null,"altCities":[]},{"name":"Eswatini","code":"SZ","continent":"Africa","capital":"Lobamba","gov":"Absolute Monarchy","demonym":"Swazi","languages":["English","Swazi"],"economy":null,"altCities":[]},{"name":"Sint Maarten","code":"SX","continent":"Americas","capital":"Philipsburg","gov":"Republic","demonym":"St. Maartener","languages":["English","French","Dutch"],"economy":null,"altCities":[]},{"name":"Seychelles","code":"SC","continent":"Africa","capital":"Victoria","gov":"Republic","demonym":"Seychellois","languages":["Seychellois Creole","English","French"],"economy":null,"altCities":[]},{"name":"Syria","code":"SY","continent":"Asia","capital":"Damascus","gov":"Republic","demonym":"Syrian","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Turks and Caicos Islands","code":"TC","continent":"Americas","capital":"Cockburn Town","gov":"Republic","demonym":"Turks and Caicos Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Chad","code":"TD","continent":"Africa","capital":"N'Djamena","gov":"Republic","demonym":"Chadian","languages":["Arabic","French"],"economy":null,"altCities":[]},{"name":"Togo","code":"TG","continent":"Africa","capital":"Lomé","gov":"Republic","demonym":"Togolese","languages":["French"],"economy":null,"altCities":[]},{"name":"Thailand","code":"TH","continent":"Asia","capital":"Bangkok","gov":"Constitutional Monarchy","demonym":"Thai","languages":["Thai"],"economy":null,"altCities":[]},{"name":"Tajikistan","code":"TJ","continent":"Asia","capital":"Dushanbe","gov":"Republic","demonym":"Tadzhik","languages":["Russian","Tajik"],"economy":null,"altCities":[]},{"name":"Tokelau","code":"TK","continent":"Oceania","capital":"Fakaofo","gov":"Republic","demonym":"Tokelauan","languages":["English","Samoan","Tokelauan"],"economy":null,"altCities":[]},{"name":"Turkmenistan","code":"TM","continent":"Asia","capital":"Ashgabat","gov":"Republic","demonym":"Turkmen","languages":["Russian","Turkmen"],"economy":null,"altCities":[]},{"name":"Timor-Leste","code":"TL","continent":"Asia","capital":"Dili","gov":"Republic","demonym":"East Timorese","languages":["Portuguese","Tetum"],"economy":null,"altCities":[]},{"name":"Tonga","code":"TO","continent":"Oceania","capital":"Nuku'alofa","gov":"Constitutional Monarchy","demonym":"Tongan","languages":["English","Tongan"],"economy":null,"altCities":[]},{"name":"Trinidad and Tobago","code":"TT","continent":"Americas","capital":"Port of Spain","gov":"Republic","demonym":"Trinidadian","languages":["English"],"economy":null,"altCities":[]},{"name":"Tunisia","code":"TN","continent":"Africa","capital":"Tunis","gov":"Republic","demonym":"Tunisian","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"Türkiye","code":"TR","continent":"Asia","capital":"Ankara","gov":"Republic","demonym":"Turkish","languages":["Turkish"],"economy":null,"altCities":[]},{"name":"Tuvalu","code":"TV","continent":"Oceania","capital":"Funafuti","gov":"Constitutional Monarchy","demonym":"Tuvaluan","languages":["English","Tuvaluan"],"economy":null,"altCities":[]},{"name":"Taiwan","code":"TW","continent":"Asia","capital":"Taipei","gov":"Republic","demonym":"Taiwanese","languages":["Chinese"],"economy":null,"altCities":[]},{"name":"Tanzania","code":"TZ","continent":"Africa","capital":"Dodoma","gov":"Republic","demonym":"Tanzanian","languages":["English","Swahili"],"economy":null,"altCities":[]},{"name":"Uganda","code":"UG","continent":"Africa","capital":"Kampala","gov":"Republic","demonym":"Ugandan","languages":["English","Swahili"],"economy":null,"altCities":[]},{"name":"Ukraine","code":"UA","continent":"Europe","capital":"Kyiv","gov":"Republic","demonym":"Ukrainian","languages":["Ukrainian"],"economy":null,"altCities":[]},{"name":"United States Minor Outlying Islands","code":"UM","continent":"Americas","capital":null,"gov":"Republic","demonym":"American Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Uruguay","code":"UY","continent":"Americas","capital":"Montevideo","gov":"Republic","demonym":"Uruguayan","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"United States","code":"US","continent":"Americas","capital":"Washington D.C.","gov":"Federation","demonym":"American","languages":["English"],"economy":"Technology and services","altCities":[]},{"name":"Uzbekistan","code":"UZ","continent":"Asia","capital":"Tashkent","gov":"Republic","demonym":"Uzbekistani","languages":["Russian","Uzbek"],"economy":null,"altCities":[]},{"name":"Vatican City","code":"VA","continent":"Europe","capital":"Vatican City","gov":"Republic","demonym":"Vatican","languages":["Italian","Latin"],"economy":null,"altCities":[]},{"name":"Saint Vincent and the Grenadines","code":"VC","continent":"Americas","capital":"Kingstown","gov":"Constitutional Monarchy","demonym":"Saint Vincentian","languages":["English"],"economy":null,"altCities":[]},{"name":"Venezuela","code":"VE","continent":"Americas","capital":"Caracas","gov":"Republic","demonym":"Venezuelan","languages":["Spanish"],"economy":null,"altCities":[]},{"name":"British Virgin Islands","code":"VG","continent":"Americas","capital":"Road Town","gov":"Republic","demonym":"Virgin Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"United States Virgin Islands","code":"VI","continent":"Americas","capital":"Charlotte Amalie","gov":"Republic","demonym":"Virgin Islander","languages":["English"],"economy":null,"altCities":[]},{"name":"Vietnam","code":"VN","continent":"Asia","capital":"Hanoi","gov":"Republic","demonym":"Vietnamese","languages":["Vietnamese"],"economy":null,"altCities":[]},{"name":"Vanuatu","code":"VU","continent":"Oceania","capital":"Port Vila","gov":"Republic","demonym":"Ni-Vanuatu","languages":["Bislama","English","French"],"economy":null,"altCities":[]},{"name":"Wallis and Futuna","code":"WF","continent":"Oceania","capital":"Mata-Utu","gov":"Republic","demonym":"Wallis and Futuna Islander","languages":["French"],"economy":null,"altCities":[]},{"name":"Samoa","code":"WS","continent":"Oceania","capital":"Apia","gov":"Republic","demonym":"Samoan","languages":["English","Samoan"],"economy":null,"altCities":[]},{"name":"Yemen","code":"YE","continent":"Asia","capital":"Sana'a","gov":"Republic","demonym":"Yemeni","languages":["Arabic"],"economy":null,"altCities":[]},{"name":"South Africa","code":"ZA","continent":"Africa","capital":"Pretoria","gov":"Republic","demonym":"South African","languages":["Zulu","Xhosa","Afrikaans","English"],"economy":"Gold and diamonds","altCities":["Cape Town","Johannesburg","Bloemfontein","Pretoria"]},{"name":"Zambia","code":"ZM","continent":"Africa","capital":"Lusaka","gov":"Republic","demonym":"Zambian","languages":["English"],"economy":null,"altCities":[]},{"name":"Zimbabwe","code":"ZW","continent":"Africa","capital":"Harare","gov":"Republic","demonym":"Zimbabwean","languages":["Chibarwe","English","Kalanga","Khoisan","Ndau","Northern Ndebele","Chewa","Shona","Sotho","Tonga","Tswana","Tsonga","Venda","Xhosa","Zimbabwean Sign Language"],"economy":null,"altCities":[]}]</script>
<script>
'use strict';

document.addEventListener('DOMContentLoaded', () => {
  const COUNTRIES = JSON.parse(document.getElementById('countriesData').textContent);
  const $ = (id) => document.getElementById(id);
  $('count').textContent = String(COUNTRIES.length);

  // keep UI clickable even if something goes wrong
  window.addEventListener('error', (e) => console.error('JS error:', e.message, e.error));

  const flag = (code) => String.fromCodePoint(0x1F1E6 + code.charCodeAt(0) - 65, 0x1F1E6 + code.charCodeAt(1) - 65);
  const shuffle = (a) => a.sort(() => Math.random() - 0.5);
  const canon = (s) => String(s).toLowerCase().replace(/\(.*?\)/g,'').replace(/\s+/g,' ').trim();
  const clamp = (n,a,b) => Math.max(a, Math.min(b, n));

  function uniqueOptions(correct, pool, n) {
    const seen = new Set([canon(correct)]);
    const out = [];
    for (const p of shuffle(pool.slice())) {
      const k = canon(p);
      if (!seen.has(k)) { seen.add(k); out.push(p); }
      if (out.length === n) break;
    }
    return out;
  }

  function toast(msg) {
    const t = $('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 1800);
  }

  // Progression store
  const STORE_KEY = 'geo_kombat_progress_v1';
  const todayKey = () => new Date().toISOString().slice(0,10);

  const defaultProgress = () => ({
    xp: 0,
    level: 1,
    bestStreak: 0,
    daily: { date: '', completed: false },
    achievements: {},
    stats: { FLAG: {c:0,t:0}, CAP: {c:0,t:0}, NAT: {c:0,t:0}, LANG: {c:0,t:0}, GOV: {c:0,t:0}, ECO: {c:0,t:0} },
    countryMistakes: {},
  });

  function loadProgress() {
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return defaultProgress();
      const p = JSON.parse(raw);
      return Object.assign(defaultProgress(), p);
    }catch{
      return defaultProgress();
    }
  }
  function saveProgress() { localStorage.setItem(STORE_KEY, JSON.stringify(PROG)); }

  let PROG = loadProgress();

  function xpToNext(level) { return Math.round(140 + Math.pow(level, 1.15) * 55); }

  function setLocked(id, locked) {
    const el = $(id);
    if (!el) return;
    if (locked) el.classList.add('locked');
    else el.classList.remove('locked');
  }

  function syncHUD() {
    $('xp').textContent = String(PROG.xp);
    $('level').textContent = String(PROG.level);
    $('bestStreak').textContent = String(PROG.bestStreak);

    const next = xpToNext(PROG.level);
    $('xpFill').style.width = clamp((PROG.xp / next) * 100, 0, 100).toFixed(1) + '%';

    const isToday = (PROG.daily.date === todayKey());
    const done = isToday && PROG.daily.completed;
    $('dailyTag').textContent = done ? 'Completed' : 'Not completed';
    $('dailyTag').className = done ? 'pill good' : 'pill warn';

    setLocked('modeTime', PROG.level < 5);
    setLocked('modeSurvival', PROG.level < 3);
  }

  function unlockAch(id) {
    if (PROG.achievements[id]) return;
    PROG.achievements[id] = true;
    saveProgress();
    toast('Achievement unlocked');
  }

  function addXP(amount) {
    amount = Math.max(0, Math.round(amount));
    if (!amount) return 0;
    PROG.xp += amount;

    let leveled = 0;
    while (PROG.xp >= xpToNext(PROG.level)) {
      PROG.xp -= xpToNext(PROG.level);
      PROG.level += 1;
      leveled += 1;
    }
    if (leveled) {
      toast(leveled === 1 ? `Level up → ${PROG.level}` : `Level up x${leveled} → ${PROG.level}`);
      if (PROG.level === 3) toast('Survival unlocked');
      if (PROG.level === 5) toast('Time Attack unlocked');
    }

    saveProgress();
    syncHUD();
    return amount;
  }

  function setBestStreak(s) {
    PROG.bestStreak = Math.max(PROG.bestStreak, s);
    saveProgress();
    $('bestStreak').textContent = String(PROG.bestStreak);
  }

  const ACH = [
    {id:'daily1', icon:'📅', title:'Daily discipline', desc:'Complete today\'s Daily Challenge.'},
    {id:'streak5', icon:'🔥', title:'On a roll', desc:'Reach a 5-answer streak.'},
    {id:'streak10', icon:'⚡', title:'Unstoppable', desc:'Reach a 10-answer streak.'},
    {id:'flags50', icon:'🚩', title:'Flag hunter', desc:'Answer 50 flag questions correctly.'},
    {id:'caps50', icon:'🏙️', title:'Capital analyst', desc:'Answer 50 capital questions correctly.'},
    {id:'score90', icon:'🎯', title:'Exam 90+', desc:'Score 90/100 or higher in Exam.'},
    {id:'time40', icon:'⏱️', title:'Fast hands', desc:'Get 40+ correct in Time Attack.'},
  ];

  function renderAchievements() {
    const wrap = $('achList');
    wrap.innerHTML = '';
    ACH.forEach(a => {
      const unlocked = !!PROG.achievements[a.id];
      const div = document.createElement('div');
      div.className = 'ach' + (unlocked ? '' : ' achLocked');
      div.innerHTML = `
        <div class="achIcon">${a.icon}</div>
        <div>
          <div class="achTitle">${a.title}</div>
          <div class="achDesc">${a.desc}</div>
        </div>
        <div style="margin-left:auto" class="pill">${unlocked ? 'Unlocked' : 'Locked'}</div>
      `;
      wrap.appendChild(div);
    });
  }

  const screens = {
    menu: $('screenMenu'),
    game: $('screenGame'),
    results: $('screenResults'),
    achievements: $('screenAchievements')
  };
  function show(which) {
    Object.values(screens).forEach(s => s.classList.remove('active'));
    screens[which].classList.add('active');
    $('btnMenu').disabled = (which === 'menu');
  }

  // Weighted pick (spaced repetition feel)
  function weightedCountryPick() {
    const weights = COUNTRIES.map(c => 1 + Math.min(6, (PROG.countryMistakes[c.code] || 0) / 2));
    let sum = 0;
    for (const w of weights) sum += w;
    let r = Math.random() * sum;
    for (let i=0; i<COUNTRIES.length; i++) {
      r -= weights[i];
      if (r <= 0) return COUNTRIES[i];
    }
    return COUNTRIES[Math.floor(Math.random() * COUNTRIES.length)];
  }

  function buildQuestion(forceType=null){
    // choose a topic that has enough coverage
    const usable = TYPES.filter(t => poolFor(t).length >= 12);
    const t = forceType && usable.includes(forceType) ? forceType : pick(usable);
    const pool = poolFor(t);
    const c = pick(pool);

    let q = '';
    let correct = '';
    let options = [];
    let extra = '';

    if (t==='FLAG'){
      q = `Which flag belongs to <b>${c.name}</b>?`;
      correct = flag(c.code);
      options = uniqueOptions(correct, COUNTRIES.filter(x=>x.code).map(x=>flag(x.code)), 3);
      options.push(correct);
      options = shuffle(options);
      extra = c.continent || '';
    }

    if (t==='CAP'){
      if (c.name==='South Africa'){
        q = `South Africa has three capitals. Which one is the <b>administrative</b> capital?`;
        correct = 'Pretoria';
        const cities = (c.altCities && c.altCities.length) ? c.altCities : ['Cape Town','Pretoria','Bloemfontein','Johannesburg'];
        options = shuffle(cities.slice(0,4));
      } else {
        q = `What is the capital of <b>${c.name}</b>?`;
        correct = c.capital;
        const traps = (c.altCities || []).slice(0,3);
        if (traps.length>=3){
          options = shuffle([correct, ...traps].slice(0,4));
        } else {
          const poolCaps = COUNTRIES.filter(x=>x.capital && x.name!==c.name && x.continent===c.continent).map(x=>x.capital);
          options = uniqueOptions(correct, poolCaps, 3);
          options.push(correct);
          options = shuffle(options);
        }
      }
      extra = c.continent || '';
    }

    if (t==='NAT'){
      q = `A person from <b>${c.name}</b> is:`;
      correct = c.demonym;
      const demPool = COUNTRIES.filter(x=>x.demonym && x.name!==c.name).map(x=>x.demonym);
      const miss = misspellWord(correct);
      options = uniqueOptions(correct, [miss, ...demPool], 3);
      options.push(correct);
      options = shuffle(options);
      extra = c.continent || '';
    }

    if (t==='LANG'){
      q = `What language is spoken in <b>${c.name}</b>?`;
      correct = formatLangAnswer(c);

      const d = [];
      const langs = LANG_PHRASE_OVERRIDE[c.name] ? [] : (c.languages || []);
      if (langs.length){
        d.push(`Only ${langs[0]}`);
        if (langs[1]) d.push(`Only ${langs[1]}`);
        if (langs.length>=2) d.push(langs.slice(0, Math.min(3, langs.length-1)).join(', '));
      } else {
        d.push('Only English'); d.push('Only Hausa'); d.push('Only Yoruba');
      }
      const other = shuffle(poolFor('LANG').filter(x=>x.name!==c.name)).slice(0,10);
      for (const oc of other){
        const oa = formatLangAnswer(oc);
        if (oa && canon(oa)!==canon(correct)) d.push(oa);
        if (d.length>20) break;
      }

      options = uniqueOptions(correct, d, 3);
      options.push(correct);
      options = shuffle(options);
      extra = c.continent || '';
    }

    if (t==='GOV'){
      q = `The <b>${c.name}</b> has:`;
      correct = GOV_OVERRIDE[c.name] || c.gov || 'Republic';
      const poolGov = GOV_OPTIONS.filter(x=>canon(x)!==canon(correct));
      options = uniqueOptions(correct, poolGov, 3);
      options.push(correct);
      options = shuffle(options);
      extra = c.continent || '';
    }

    if (t==='ECO'){
      q = `<b>${c.name}</b> is famous for producing / exporting:`;
      correct = c.economy;
      const econPool = COUNTRIES.filter(x=>x.economy && x.name!==c.name).map(x=>x.economy);
      options = uniqueOptions(correct, econPool, 3);
      options.push(correct);
      options = shuffle(options);
      extra = c.continent || '';
    }

    return {type:t, q, a:correct, options, extra, country:c};
  }

  function syncRunHUD() {
    $('lifeCount').textContent = String(lifelines);
    $('streak').textContent = String(streak);
  }

  function resetRun() {
    clearInterval(timerInt);
    timerInt = null;
    current = null;
    locked = false;
    score = 0; total = 0; mistakes = [];
    lifelines = 3;
    streak = 0;
    timeLeft = 0;
    earnedXPThisRun = 0;
    syncRunHUD();
    $('timer').style.display = 'none';
    $('timer').textContent = '';
    $('hint').textContent = '';
    $('answers').innerHTML = '';
    $('tags').innerHTML = '';
    $('progress').textContent = '';
  }

  function bumpStats(type, correct) {
    const s = PROG.stats[type] || {c:0,t:0};
    s.t += 1;
    if (correct) s.c += 1;
    PROG.stats[type] = s;
  }

  function streakRewards() {
    if (streak === 5) unlockAch('streak5');
    if (streak === 10) unlockAch('streak10');
    if (streak > 0 && streak % 5 === 0) {
      lifelines = Math.min(5, lifelines + 1);
      syncRunHUD();
      toast('+1 lifeline (streak)');
    }
  }

  function renderQ() {
    locked = false;
    $('hint').textContent = '';

    if (gameMode === 'daily') {
      const plan = ['CAP','CAP','CAP','CAP','FLAG','FLAG','FLAG','GOV','GOV','ECO'];
      const type = plan[total] || null;
      current = buildQuestion(type);
      $('progress').textContent = `Daily ${total+1} / 10`;
    } else if (gameMode === 'exam') {
      current = buildQuestion();
      $('progress').textContent = `Question ${total+1} / ${examLimit}`;
    } else {
      current = buildQuestion();
      $('progress').textContent = '';
    }

    const tags = $('tags');
    tags.innerHTML = '';
    const t1 = document.createElement('span'); t1.className='pill'; t1.textContent = current.meta.continent || '—';
    const t2 = document.createElement('span'); t2.className='pill'; t2.textContent = current.type;
    tags.appendChild(t1); tags.appendChild(t2);

    $('question').textContent = current.q;

    const answers = $('answers');
    answers.innerHTML = '';
    current.options.forEach(opt => {
      const d = document.createElement('div');
      d.className = 'ans';
      d.textContent = opt;
      d.addEventListener('click', () => choose(opt, d));
      answers.appendChild(d);
    });
  }

  function choose(opt, node) {
    if (locked) return;
    locked = true;

    document.querySelectorAll('.ans').forEach(el => {
      if (el.textContent === current.a) el.classList.add('correct');
      el.classList.add('lock');
    });

    const isCorrect = (opt === current.a);
    if (!isCorrect) {
      node.classList.add('wrong');
      $('screenGame').classList.add('shake');
      setTimeout(()=> $('screenGame').classList.remove('shake'), 450);
    }

    total++;
    if (isCorrect) score++;

    bumpStats(current.type, isCorrect);

    if (!isCorrect) {
      PROG.countryMistakes[current.meta.code] = (PROG.countryMistakes[current.meta.code] || 0) + 1;
      mistakes.push({q: current.q, picked: opt, correct: current.a});
    } else {
      const k = PROG.countryMistakes[current.meta.code] || 0;
      if (k > 0) PROG.countryMistakes[current.meta.code] = Math.max(0, k - 1);
    }

    let gained = 0;
    if (isCorrect) {
      streak++;
      setBestStreak(streak);
      gained = 10;
      if (streak >= 3) gained += 2;
      if (streak >= 7) gained += 4;
      gained += Math.min(10, Math.floor(streak/5) * 2);
      gained = Math.min(26, gained);
      streakRewards();

      if (current.type === 'FLAG' && (PROG.stats.FLAG?.c || 0) >= 50) unlockAch('flags50');
      if (current.type === 'CAP' && (PROG.stats.CAP?.c || 0) >= 50) unlockAch('caps50');
    } else {
      streak = 0;
    }
    syncRunHUD();

    if (gained) {
      earnedXPThisRun += gained;
      addXP(gained);
      toast(`+${gained} XP`);
    }

    saveProgress();
    syncHUD();

    if (gameMode === 'survival' && !isCorrect) return endGame('Survival ended (1 mistake).');
    if (gameMode === 'exam' && total >= examLimit) return endGame();
    if (gameMode === 'daily' && total >= 10) {
      const bonus = 40;
      earnedXPThisRun += bonus;
      addXP(bonus);
      PROG.daily = { date: todayKey(), completed: true };
      unlockAch('daily1');
      saveProgress();
      syncHUD();
      return endGame('Daily complete. Bonus XP granted.');
    }
    if (gameMode === 'time') {
      setTimeout(renderQ, 200);
    }
  }

  function endGame(note=null) {
    clearInterval(timerInt);
    timerInt = null;
    show('results');

    let scoreText = '';
    if (gameMode === 'exam') {
      const pct = total ? Math.round((score / total) * 100) : 0;
      scoreText = `Exam score: ${pct}/100 (${score}/${total})`;
      if (pct >= 90) unlockAch('score90');
    } else if (gameMode === 'time') {
      scoreText = `Time Attack: ${score} correct (${total} attempted)`;
      if (score >= 40) unlockAch('time40');
    } else if (gameMode === 'daily') {
      scoreText = `Daily: ${score}/${total} correct`;
    } else if (gameMode === 'survival') {
      scoreText = `Survival: ${score} correct before failure`;
    } else {
      scoreText = `Practice: ${score}/${total} correct`;
    }
    if (note) scoreText += ` · ${note}`;

    $('scoreLine').textContent = scoreText;
    $('rewardLine').textContent = `+${earnedXPThisRun} XP`;

    $('btnReview').disabled = (mistakes.length === 0);
    $('review').innerHTML = '';
    saveProgress();
    syncHUD();
  }

  // Lifeline
  $('btnLifeline').addEventListener('click', () => {
    if (lifelines <= 0 || !current || locked) return;
    lifelines--;
    syncRunHUD();

    const all = [...document.querySelectorAll('.ans')];
    const correct = all.find(x => x.textContent === current.a);
    const wrong = all.filter(x => x !== correct && !x.classList.contains('hide'));
    shuffle(wrong).slice(1).forEach(x => x.classList.add('hide'));
  });

  function start(modeName) {
    if (modeName === 'time' && PROG.level < 5) return toast('Time Attack unlocks at Level 5');
    if (modeName === 'survival' && PROG.level < 3) return toast('Survival unlocks at Level 3');

    resetRun();
    gameMode = modeName;
    examLimit = parseInt($('examCount').value, 10);
    show('game');

    if (modeName === 'time') {
      $('timer').style.display = 'block';
      timeLeft = 90;
      $('timer').textContent = timeLeft;
      timerInt = setInterval(() => {
        timeLeft--;
        $('timer').textContent = timeLeft;
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    renderQ();
  }

  function startDaily() {
    if (PROG.daily.date !== todayKey()) {
      PROG.daily = { date: todayKey(), completed: false };
      saveProgress();
    }
    if (PROG.daily.completed) return toast('Daily already completed today');
    start('daily');
  }

  // Menu wiring
  $('btnMenu').addEventListener('click', () => show('menu'));
  $('modePractice').addEventListener('click', () => start('practice'));
  $('modeExam').addEventListener('click', () => start('exam'));
  $('modeTime').addEventListener('click', () => { if (!$('modeTime').classList.contains('locked')) start('time'); });
  $('modeSurvival').addEventListener('click', () => { if (!$('modeSurvival').classList.contains('locked')) start('survival'); });
  $('btnDaily').addEventListener('click', () => startDaily());

  $('btnNext').addEventListener('click', () => { if (gameMode !== 'time') renderQ(); });
  $('btnRestart').addEventListener('click', () => start(gameMode || 'practice'));
  $('btnRestart2').addEventListener('click', () => start(gameMode || 'practice'));

  $('btnAchievements').addEventListener('click', () => { renderAchievements(); show('achievements'); });
  $('btnBackFromAch').addEventListener('click', () => show('menu'));

  $('btnReview').addEventListener('click', () => {
    const wrap = $('review');
    wrap.innerHTML = '';
    if (!mistakes.length) return (wrap.innerHTML = '<div class="note">No mistakes.</div>');
    mistakes.forEach(m => {
      const div = document.createElement('div');
      div.className = 'card';
      div.style.padding = '12px';
      div.style.marginTop = '10px';
      div.innerHTML = `<div style="font-weight:950">${m.q}</div>
        <div class="note" style="margin-top:8px">Picked: <b>${m.picked}</b><br>Correct: <b>${m.correct}</b></div>`;
      wrap.appendChild(div);
    });
  });

  $('btnResetProgress').addEventListener('click', () => {
    if (!confirm('Reset all progress? This clears XP, level, streak, achievements and daily status.')) return;
    localStorage.removeItem(STORE_KEY);
    PROG = loadProgress();
    resetRun();
    syncHUD();
    toast('Progress reset');
  });

  // Daily rollover + init
  if (PROG.daily.date !== todayKey()) {
    PROG.daily = { date: todayKey(), completed: false };
    saveProgress();
  }
  syncHUD();
  syncRunHUD();
  show('menu');
});
</script>
</body>
</html>
